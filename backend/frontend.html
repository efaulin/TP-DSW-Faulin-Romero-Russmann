<!DOCTYPE html>
<html>

<head>
  <title>Socket.IO chat</title>
  <style></style>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    //Clase player
    class player{
      constructor({user, x, y, label, salto}){
        this.user = user;
        this.x = x;
        this.y = y;
        this.label = label;
        this.salto = salto;

        this.label.textContent = user;
      }
    }
  
    const urlParams = new URLSearchParams(window.location.search);
    const user = urlParams.get('user');
    var socket = io({
        extraHeaders: {
          "user": user
        }
    });
    const players = {}
    /*const labels = {}
    const saltos = {}*/

    socket.on('updatePlayers', (backendPlayers) => {
      for (const id in backendPlayers){
        const bkdPly = backendPlayers[id]

        if (!players[id]){
          players[id] = new player({
            user: bkdPly.user,
            x: bkdPly.x,
            y: bkdPly.y,
            label: document.createElement("label"),
            salto: document.createElement("br")
          });
          //players[id].label.textContent = players[id]
          /*labels[id] = document.createElement("label");
          labels[id].textContent = players[id].user;
          saltos[id] = document.createElement("br");*/

          var lista = document.getElementById("lobby");
          lista.appendChild(players[id].label);
          lista.appendChild(players[id].salto);
        }
      }

      for (const id in players) {
        if (!backendPlayers[id]) {
          players[id].label.remove()
          players[id].salto.remove()
          delete players[id]
        }
      }

      console.log(players)
    });

    socket.on('newMsg', (msg) => {
      var li = document.createElement("li");
      li.textContent = `[${msg.user}]: ${msg.msg}`;
      var chat = document.getElementById("chat");
      chat.appendChild(li);
    })

    function sendMsg(){
      var text = document.getElementById("text");
      console.log(text.value)
      socket.emit("sendMsg", text.value);
      text.value = "";
    }
  </script>
</head>

<body style="background-color: black;">
  <h1 style="color: whitesmoke;">Chat dou</h1>
  <h2 style="margin: 2px 0px 2px; color: whitesmoke;">Lobby:</h2>
  <span id="lobby" style="color: whitesmoke;"></span>
  <input type="text" id="text">
  <input type="button" onclick="sendMsg()" value="Enviar">
  <div style="overflow-x: hidden; overflow-y: scroll; max-height: 500px;">
    <ul title="Chat" id="chat" style="color: whitesmoke;"></ul>
  </div>
</body>

</html>