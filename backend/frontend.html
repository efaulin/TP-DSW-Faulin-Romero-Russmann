<!DOCTYPE html>
<html>

<head>
  <title>Socket.IO chat</title>
  <style></style>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    //Clase player
    class player{
      constructor(user, x, y){
        this.user = user;
        this.x = x;
        this.y = y;
      }
    }
  
    const urlParams = new URLSearchParams(window.location.search);
    const user = urlParams.get('user');
    var socket = io({
        extraHeaders: {
          "user": user
        }
});
    const players = {}
    const labels = {}
    const saltos = {}

    socket.on('updatePlayers', (backendPlayers) => {
      for (const id in backendPlayers){
        const bkdPly = backendPlayers[id]

        if (!players[id]){
          players[id] = new player(bkdPly.user, bkdPly.x, bkdPly.y);
          labels[id] = document.createElement("label");
          labels[id].textContent = players[id].user;
          saltos[id] = document.createElement("br");

          var lista = document.getElementById("lista");
          lista.appendChild(labels[id]);
          lista.appendChild(saltos[id]);
        }
      }

      for (const id in players) {
        if (!backendPlayers[id]) {
          delete players[id]
          labels[id].remove()
          delete labels[id]
          saltos[id].remove()
          delete saltos[id]
        }
      }

      console.log(players)
    });

  </script>
</head>

<body>
  <h1>Chat dou</h1>
  <h2 style="margin: 2px 0px 2px;">Lobby:</h2>
  <span id="lista"></span>
</body>

</html>